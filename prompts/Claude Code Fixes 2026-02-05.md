# Claude Code 修复需求（增量修改｜禁止重做）

> 仅在现有实现基础上修复以下问题：不要重做 UI、不要改布局结构，只做可用性修复与状态逻辑补齐。

---

## 1) 新增任务：时间选择器「确认」按钮超出屏幕（无法点击）

### 现象

在新增任务（Add Task Modal）里，点击开始时间/结束时间会打开时间选择器（Time Picker）。当 Time Picker 展开后，底部「确认」按钮会被屏幕下沿遮挡，导致无法点击。

### 目标

- **任何屏幕高度下**，「确认」按钮必须可见且可点击。
- 行为与设计一致：时间选择器仍在当前 modal 内，不要改成交互跳转或新页面。

### 建议实现（任选其一，优先按最小改动）

**方案 A（推荐）**：让 Time Picker 容器可滚动，并为底部按钮预留安全区

- Time Picker 外层容器设置 `max-height: calc(100vh - Xpx)`（X 为 modal 头部与输入区域高度估算）
- 容器 `overflow-y: auto`
- 底部按钮区域 `position: sticky; bottom: 0;` 并加 `padding-bottom: env(safe-area-inset-bottom)`

**方案 B**：将「确认」按钮固定在 Time Picker 的底部（sticky/footer）

- 不改变视觉结构，只保证按钮在可视区域内

**方案 C**：自动滚动到按钮

- Time Picker 打开后，调用 `scrollIntoView({block: 'end'})` 确保确认按钮进入视口

### 验收标准

- iPhone Safari / Chrome（移动端）打开 Time Picker 时，「确认」按钮必定可点。
- 不出现页面整体抖动或遮挡输入框。

---

## 2) 周视图 Bottom Sheet：状态按钮需支持「三态」并实时联动

### 当前问题

周视图 Bottom Sheet 里目前只做了两态：

- 标记为完成
- 取消完成

但需求是任务状态三态循环：**待办 → 进行中 → 已完成**。

### 目标

- Bottom Sheet 中展示任务当前状态（已有的话保持）。
- Bottom Sheet 中的操作按钮根据当前状态**动态变化**：


| 当前状态             | 按钮文案   | 点击后变为            |
| ---------------- | ------ | ---------------- |
| 待办（TODO）         | 标记为进行中 | 进行中（IN_PROGRESS） |
| 进行中（IN_PROGRESS） | 标记为已完成 | 已完成（DONE）        |
| 已完成（DONE）        | 取消完成   | 待办（TODO）         |


- 点击按钮后：
  1. 任务状态在 Bottom Sheet 内**立刻更新显示**（不需要关闭弹窗）
  2. 按钮文案/逻辑也**立刻更新**
  3. 周视图列表对应任务的 UI 也同步刷新（状态样式、徽标等）

### 实现要求

- 不新增第二个状态入口；Bottom Sheet 的状态按钮是唯一的状态控制入口（保持你当前周视图“点击任务打开 Bottom Sheet”的交互）。
- 状态枚举建议统一：`TODO / IN_PROGRESS / DONE`（或你项目现有命名，但必须三态）。
- 状态变更要写入同一份任务数据源（state/store），避免仅在 Bottom Sheet 本地 state 里改导致列表不同步。

### 验收标准

- 在 Bottom Sheet 内连续点击状态按钮，能按三态规则循环。
- 状态展示与按钮文案始终匹配当前状态。
- 列表与 Bottom Sheet 状态永远一致。

---

## 3) 交付要求（重要）

- 这是 **增量修复**：不要重构、不要重做 UI。
- 只改必要代码，优先小范围 patch。
- 修复后请给出：
  - 修改了哪些文件（文件路径列表）
  - 关键改动点（简述）
  - 如何手动验证（步骤）

